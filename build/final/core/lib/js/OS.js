for(var h="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=e.value)},k="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global?global:this,A=["Array","prototype","fill"],C=0;C<A.length-1;C++){var E=A[C];E in k||(k[E]={});k=k[E]}
var F=A[A.length-1],G=k[F],H=G?G:function(a,b,e){var g=this.length||0;0>b&&(b=Math.max(0,g+b));if(null==e||e>g)e=g;e=Number(e);0>e&&(e=Math.max(0,g+e));for(b=Number(b||0);b<e;b++)this[b]=a;return this};H!=G&&null!=H&&h(k,F,{configurable:!0,writable:!0,value:H});window.onload=function(){var a={};I("/core/os/default/System.json",function(b){a.S=JSON.parse(b);J(a)},"GET")};var K,L,M,N=(new Date).getTime();
function J(a){function b(){r.clear();r.fillStyle=K.osDesktopBackground;r.fillRect(0,0,e.width,e.height);for(var f=0;f<M.length;f++){var a=M[f];if(a.j){var b=document.getElementById("wcanvas_"+a.id);null==b&&(b=document.createElement("canvas"),b.setAttribute("class","dynamic-canvas"),b.setAttribute("id","wcanvas_"+a.id),document.body.appendChild(b));b.width=a.width;b.height=a.height;var p=b.getContext("2d"),d=document.getElementById("gcanvas_"+a.id);null==d&&(d=document.createElement("canvas"),d.setAttribute("class",
"dynamic-canvas"),d.setAttribute("id","gcanvas_"+a.id),document.body.appendChild(d));d.width=a.width;d.height=a.height-K.osWindowOptionsHeight;var c=d.getContext("2d");p.fillStyle=K.osWindowOptionsBackground;p.fillRect(0,0,a.width,K.osWindowOptionsHeight);p.fillStyle="null"==a.f.I?a.f.I:K.osWindowContentBackground;p.fillRect(0,K.osWindowOptionsHeight,a.width,a.height-K.osWindowOptionsHeight);try{p.drawImage(a.icon,K.osWindowOptionsPadding,K.osWindowOptionsHeight/2-K.osWindowIconHeight/2,K.osWindowIconWidth,
K.osWindowIconHeight)}catch(da){a.icon=Image.o()}p.font=K.osWindowContentFont;p.textBaseline="middle";p.fillStyle=K.osWindowOptionsColor;p.fillText(a.title,K.osWindowOptionsPadding+K.osWindowIconWidth+K.osWindowOptionsTitleIconSeperation,K.osWindowOptionsHeight/2);p.textBaseline="top";for(var g=0;g<a.f.elements.length;g++){var m=a.f.elements[g],l=m.data;m.type==n.l&&(c.textBaseline=l.h.baseline,c.textAlign=l.h.align);if(O(l.fc))switch(c.fillStyle=l.fc,m.type){case n.D:c.fillRect(l.x,l.y,l.w,l.h);
break;case n.A:c.ellipse(l.x+l.w/2,l.y+l.h/2,l.w/2,l.h/2,0,0,2*Math.PI);c.fill();break;case n.l:c.font=l.h.font,c.fillText(l.w,l.x,l.y)}if(O(l.sc))switch(c.strokeStyle=l.sc,c.lineWidth=l.ss,m.type){case n.D:c.strokeRect(l.x,l.y,l.w,l.h);break;case n.A:c.ellipse(l.x,l.y,l.w,l.h);c.stroke();break;case n.L:c.moveTo(l.x,l.y);c.lineTo(l.w,l.h);c.stroke();break;case n.l:c.font=l.h.font,c.strokeText(l.w,l.x,l.y)}}a:{c=M;for(g=c.length-1;0<=g;g--)if(c[g].id==a.id){c=g;break a}c=void 0}c="z-index: "+c;d.setAttribute("style",
"left: "+a.x+"px; top: "+(K.osWindowOptionsHeight+a.y)+"px; "+c);b.setAttribute("style","left: "+a.x+"px; top: "+a.y+"px; "+c);p.strokeStyle=K.osWindowBorder;p.lineWidth=K.osWindowBorderWidth;p.strokeRect(0,0,a.width,a.height);p.strokeStyle=K.osWindowOptionsBorder;p.lineWidth=K.osWindowOptionsBorderWidth;p.beginPath();p.moveTo(0,K.osWindowOptionsHeight);p.lineTo(a.width,K.osWindowOptionsHeight);p.stroke()}}}var e=document.getElementById("desktop");e.width=window.innerWidth;e.height=window.innerHeight;
var g=e.getContext("2d");K=a.S;L={K:{I:K.osWindowContentBackground,elements:[]}};var n={D:0,A:1,L:2,l:3};setInterval(b,20);var r=g;M=[];new P({b:[{action:"compile",source:"/core/os/default/apps/test.js",c:"/apps/test.ose",m:function(f){console.log("Application compiled sucessfully in "+((new Date).getTime()-N).toString()+" milliseconds!");console.log("Result:\n"+f)}},{action:"execute",source:"/apps/test.ose",start:function(){console.log("Finished setup after "+((new Date).getTime()-N)+" milliseconds!")}}]});
new Window(10,10,200,100,"Test");new Window(100,100,200,100,"Test2");M[M.length-1].addEventListener("mousedown",function(f){console.log("X: "+f.x+", Y: "+f.y)});a=new Worker("text.js");a.postMessage({action:"data",value:K});a.postMessage({action:"widthIndex",value:JSON.stringify(Q())});var x=0,D=0,w=null,B=!1,v=8,m=null,y,z,t,u;window.onmousedown=function(f){var a="";w=null;B=!0;for(var b=[],e=0;e<M.length;e++)f.x>M[e].x&&f.x<M[e].x+M[e].width&&f.y>M[e].y&&f.y<M[e].y+M[e].height&&b.push(e);b.pop();
for(e=M.length-1;0<=e;e--){var d=M[e],c=K.osWindowResizeMargin;if(f.x>=d.x&&f.y>=d.y&&f.x<=d.x+d.width&&f.y<=d.y+d.height){if(-1==b.indexOf(e)){f.x>=d.x+c&&f.y>=d.y+c&&f.x<=d.x+d.width-c&&f.y<=d.y+d.height-c&&(a="window",f.y<d.y+K.osWindowOptionsHeight&&(w=d,x=f.x-d.x,D=f.y-d.y),M=M.remove(e),M.push(d),b=M[M.length-1],f.y>b.y+K.osWindowOptionsHeight&&R(b,"mousedown",{x:f.x-b.x,y:f.y-b.y-K.osWindowOptionsHeight}));break}if(e==M.length-1)break}}if(""==a)for(e=M.length-1;0<=e;e--)if(d=M[e],c=K.osWindowResizeMargin,
f.x>d.x&&f.x<d.x+c&&f.y>d.y+c&&f.y<d.y+d.height-c?v=q.B:f.x>d.x+d.width-c&&f.x<d.x+d.width&&f.y>d.y+c&&f.y<d.y+d.height-c?v=q.C:f.x>d.x+c&&f.x<d.x+d.width-c&&f.y>d.y&&f.y<d.y+c?v=q.F:f.x>d.x+c&&f.x<d.x+d.width-c&&f.y>d.y+d.height-c&&f.y<d.y+d.height?v=q.s:f.x>d.x&&f.x<d.x+c&&f.y>d.y&&f.y<d.y+c?v=q.G:f.x>d.x+d.width-c&&f.x<d.x+d.width&&f.y>d.y&&f.y<d.y+c?v=q.H:f.x>d.x&&f.x<d.x+c&&f.y>d.y+d.height-c&&f.y<d.y+d.height?v=q.u:f.x>d.x+d.width-c&&f.x<d.x+d.width&&f.y>d.y+d.height-c&&f.y<d.y+d.height&&(v=
q.v),f.x>d.x&&f.x<d.x+d.width&&f.y>d.y&&f.y<d.y+d.height&&!(f.x>d.x+c&&f.x<d.x+d.width-c&&f.y>d.y+c&&f.y<d.y+d.height-c)){m=d;t=d.x;u=d.y;y=d.width;z=d.height;break}};window.onmousemove=function(a){if(B)if(null!=w)w.j?(w.x=a.x-x,w.y=a.y-D):B=!1;else{if(v!=q.NONE)switch(v){case q.B:a.x<t+y-K.osWindowMinimumWidth&&(m.x=a.x,m.width=t-a.x+y);break;case q.C:a.x>t+K.osWindowMinimumWidth&&(m.width=a.x-t);break;case q.F:a.y<u+z-K.osWindowMinimumHeight&&(m.y=a.y,m.height=u-a.y+z);break;case q.s:a.y>u+K.osWindowMinimumHeight&&
(m.height=a.y-u);break;case q.G:a.x<t+y-K.osWindowMinimumWidth&&(m.x=a.x,m.width=t-a.x+y);a.y<u+z-K.osWindowMinimumHeight&&(m.y=a.y,m.height=u-a.y+z);break;case q.H:a.x>t+K.osWindowMinimumWidth&&(m.width=a.x-t);a.y<u+z-K.osWindowMinimumHeight&&(m.y=a.y,m.height=u-a.y+z);break;case q.u:a.x<t+y-K.osWindowMinimumWidth&&(m.x=a.x,m.width=t-a.x+y);a.y>u+K.osWindowMinimumHeight&&(m.height=a.y-u);break;case q.v:a.x>t+K.osWindowMinimumWidth&&(m.width=a.x-t),a.y>u+K.osWindowMinimumHeight&&(m.height=a.y-u)}}else{for(var b=
!1,e=[],f=0;f<M.length;f++)a.x>M[f].x&&a.x<M[f].x+M[f].width&&a.y>M[f].y&&a.y<M[f].y+M[f].height&&e.push(f);e.pop();for(var d=document.body,f=M.length-1;0<=f;f--)if(-1==e.indexOf(f)){var c=M[f],g=K.osWindowResizeMargin;a.x>c.x&&a.x<c.x+g&&a.y>c.y+g&&a.y<c.y+c.height-g?(d.style.cursor="w-resize",b=!0):a.x>c.x+c.width-g&&a.x<c.x+c.width&&a.y>c.y+g&&a.y<c.y+c.height-g?(d.style.cursor="e-resize",b=!0):a.x>c.x+g&&a.x<c.x+c.width-g&&a.y>c.y&&a.y<c.y+g?(d.style.cursor="n-resize",b=!0):a.x>c.x+g&&a.x<c.x+
c.width-g&&a.y>c.y+c.height-g&&a.y<c.y+c.height?(d.style.cursor="s-resize",b=!0):a.x>c.x&&a.x<c.x+g&&a.y>c.y&&a.y<c.y+g?(d.style.cursor="nw-resize",b=!0):a.x>c.x+c.width-g&&a.x<c.x+c.width&&a.y>c.y&&a.y<c.y+g?(d.style.cursor="ne-resize",b=!0):a.x>c.x&&a.x<c.x+g&&a.y>c.y+c.height-g&&a.y<c.y+c.height?(d.style.cursor="sw-resize",b=!0):a.x>c.x+c.width-g&&a.x<c.x+c.width&&a.y>c.y+c.height-g&&a.y<c.y+c.height&&(d.style.cursor="se-resize",b=!0)}b||(d.style.cursor="default")}b=M[M.length-1];a.x>b.x&&a.x<
b.x+b.width&&a.y>b.y+K.osWindowOptionsHeight&&a.y<b.y+b.height&&R(b,"mousemove",{x:a.x-b.x,y:a.y-b.y-K.osWindowOptionsHeight})};window.onmouseup=function(a){null!=w&&B&&(w.x=a.x-x,w.y=a.y-D,w=null,D=x=0);v!=q.NONE&&(v=q.NONE);var b=M[M.length-1];a.x>b.x&&a.x<b.x+b.width&&a.y>b.y+K.osWindowOptionsHeight&&a.y<b.y+b.height&&R(b,"mouseup",{x:a.x-b.x,y:a.y-b.y-K.osWindowOptionsHeight});B=!1};window.onresize=function(){e.width=window.innerWidth;e.height=window.innerHeight;b()};var q={B:0,C:1,F:2,s:3,G:4,
H:5,u:6,v:7,NONE:8}}function P(a){S(a)}function S(a){a="undefined"==typeof a?T:a;for(var b in a.b){var e=a.b[b];if("compile"==e.action){var g=new U(e.source,e.c,function(b){V(g,b);var e=g.compile();aa({path:e.c,content:e.code},function(){e.m(e.code);a.b=a.b.remove(0);S(a)})},e.m);break}else"execute"==e.action&&((new W(e.source)).start(),e.start())}}var T={b:[{action:"execute"}]};
function U(a,b,e,g){this.N=a;this.J=!1;this.c=b;this.R=g;a=this.N;b={};g=[];for(var n in b)g.push(encodeURIComponent(n)+"="+encodeURIComponent(b[n]));I(a+(g.length?"?"+g.join("&"):""),e,"GET",null,void 0)}U.prototype.compile=function(){if(this.J)return this.O="importScripts('"+K.scriptLangPath+"');\n"+this.M,{code:this.O,m:this.R,c:this.c};console.warn("Please wait to call compile() until source code has been loaded.")};function V(a,b){a.J=!0;a.M=b}function W(a){this.path=a;this.g=[]}
W.prototype.start=function(){this.internalWorker=new Worker("get.php?content_type=text/javascript&path="+this.path);this.internalWorker.T=this;this.internalWorker.onmessage=ba};function ba(a){X.a=this.T;X[a.data.action](a.data.params)}
var X={"System.println":function(a){console.log(a)},"System.Window.<init>":function(a){var b;console.log(a);M.push(b=new Window(a.x,a.y,a.width,a.height,a.title,void 0,a.graphics.data));b.P=this.a;Y(b);b.addEventListener("any",function(a){var b=a.executor;a.windowID=X["System.Window.getLocalID"](a.window);delete a.window;delete a.executor;b.internalWorker.postMessage(a)});this.a.g.push({global:b.id,local:a.id})},"System.Window.show":function(a){var b=this["System.Window.getGlobalWindow"](a);this["System.Window.update"](a);
b.show()},"System.Window.hide":function(a){var b=this["System.Window.getGlobalWindow"](a);this["System.Window.update"](a);Y(b)},"System.Window.update":function(a){this["System.Window.getGlobalWindow"](a).update(a)},"System.Window.getGlobalID":function(a){for(var b=0;b<this.a.g.length;b++){var e=this.a.g[b];if(e.local==a.id)return e.global}},"System.Window.getGlobalWindow":function(a){a:{a=this["System.Window.getGlobalID"](a);for(var b=0;b<M.length;b++)if(M[b].id==a){a=M[b];break a}a=void 0}return a},
"System.Window.getLocalID":function(a){for(var b=0;b<this.a.g.length;b++){var e=this.a.g[b];if(e.global==a.id)return e.local}},a:null};Array.prototype.remove=function(a){delete this[a];a=[];for(var b=0;b<this.length;b++)"undefined"!=typeof this[b]&&a.push(this[b]);return a};CanvasRenderingContext2D.prototype.clear=CanvasRenderingContext2D.prototype.clear||function(a){a&&(this.save(),this.setTransform(1,0,0,1,0,0));this.clearRect(0,0,this.canvas.width,this.canvas.height);a&&this.restore()};
function Q(){var a=K.osWindowContentFont,b=[],e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%^&*()`~-=_+[]{}|\"';:/?>.<, ".split(""),g=document.createElement("canvas").getContext("2d");g.font=a;for(a=0;a<e.length;a++){var n=e[a];b.push([n,g.measureText(n).width])}return b}Image.o=function(){var a=K.osApplicationIcon,b=new Image(K.osWindowIconWidth,K.osWindowIconHeight);b.src=a;return b};function O(a){return!("undefined"==typeof a||null==a)}
function Window(a,b,e,g,n,r,x){this.update(a,b,e,g,n,r,x);this.id=Z;this.i={};this.j=!0;this.event={mousedown:[],mouseup:[],mousemove:[],keyup:[],keydown:[],any:[]};M.push(this);Z++}Window.prototype.show=function(){this.x=this.i.x;this.y=this.i.y;this.i={};this.j=!0};function Y(a){a.i={x:a.x,y:a.y};a.x=-a.width-K.osWindowBorderWidth;a.y=-a.height-K.osWindowBorderWidth;a.j=!1}
Window.prototype.update=function(a,b,e,g,n,r,x){"object"==typeof a?(this.title=a.title,this.icon="undefined"==typeof a.icon?Image.o():a.icon,this.f="undefined"==typeof a.graphics.data?L.K:a.graphics.data):(this.x=a,this.y=b,this.width=e,this.height=g,this.title=n,this.icon="undefined"==typeof r?Image.o():r,this.f="undefined"==typeof x?L.K:x)};Window.prototype.addEventListener=function(a,b){this.event[a].push(b)};
function R(a,b,e){e.eventType=b;e.window=a;e.executor=a.P;for(var g=0;g<a.event[b].length;g++)a.event[b][g](e);for(g=0;g<a.event.any.length;g++)a.event.any[g](e)}var Z=0;function ca(){if("undefined"!==typeof XMLHttpRequest)return new XMLHttpRequest;for(var a="MSXML2.XmlHttp.6.0 MSXML2.XmlHttp.5.0 MSXML2.XmlHttp.4.0 MSXML2.XmlHttp.3.0 MSXML2.XmlHttp.2.0 Microsoft.XmlHttp".split(" "),b,e=0;e<a.length;e++)try{b=new ActiveXObject(a[e]);break}catch(g){}return b}
function I(a,b,e,g,n){void 0===n&&(n=!0);var r=ca();r.open(e,a,n);r.onreadystatechange=function(){4==r.readyState&&b(r.responseText)};"POST"==e&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded");r.send(g)}function aa(a,b){var e=[],g;for(g in a)e.push(encodeURIComponent(g)+"="+encodeURIComponent(a[g]));I("/user/set.php",b,"POST",e.join("&"),void 0)};
