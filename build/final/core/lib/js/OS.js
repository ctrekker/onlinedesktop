$.M=$.ajax;
for(var g="function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[e]=f.value)},k="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global?global:this,B=["Array","prototype","fill"],D=0;D<B.length-1;D++){var F=B[D];F in k||(k[F]={});k=k[F]}
var G=B[B.length-1],H=k[G],I=H?H:function(a,e,f){var h=this.length||0;0>e&&(e=Math.max(0,h+e));if(null==f||f>h)f=h;f=Number(f);0>f&&(f=Math.max(0,h+f));for(e=Number(e||0);e<f;e++)this[e]=a;return this};I!=H&&null!=I&&g(k,G,{configurable:!0,writable:!0,value:I});window.onload=function(){var a={};$.M({type:"GET",url:"/core/os/default/System.json",W:function(e){a.ia=e;J(a)}})};var K,L,M,N=(new Date).getTime();
function J(a){function e(){x.clear();x.fillStyle=K.na;x.fillRect(0,0,f.width,f.height);for(var b=0;b<M.length;b++){var a=M[b];if(a.s){var e=document.getElementById("wcanvas_"+a.id);null==e&&(e=document.createElement("canvas"),e.setAttribute("class","dynamic-canvas"),e.setAttribute("id","wcanvas_"+a.id),document.body.appendChild(e));e.width=a.width;e.height=a.height;var m=e.getContext("2d"),d=document.getElementById("gcanvas_"+a.id);null==d&&(d=document.createElement("canvas"),d.setAttribute("class",
"dynamic-canvas"),d.setAttribute("id","gcanvas_"+a.id),document.body.appendChild(d));d.width=a.width;d.height=a.height-K.a;var c=d.getContext("2d");m.fillStyle=K.pa;m.fillRect(0,0,a.width,K.a);m.fillStyle="null"==a.i.N?a.i.N:K.ea;m.fillRect(0,K.a,a.width,a.height-K.a);try{m.drawImage(a.icon,K.ga,K.a/2-K.T/2,K.U,K.T)}catch(ba){a.icon=Image.w()}m.font=K.fa;m.textBaseline="middle";m.fillStyle=K.sa;m.fillText(a.title,K.ga+K.U+K.ta,K.a/2);m.textBaseline="top";for(var y=0;y<a.i.elements.length;y++){var h=
a.i.elements[y],l=h.data;h.type==q.u&&(c.textBaseline=l.b.ka,c.textAlign=l.b.align);if(O(l.da))switch(c.fillStyle=l.da,h.type){case q.I:c.fillRect(l.x,l.y,l.f,l.b);break;case q.F:c.ellipse(l.x+l.f/2,l.y+l.b/2,l.f/2,l.b/2,0,0,2*Math.PI);c.fill();break;case q.u:c.font=l.b.font,c.fillText(l.f,l.x,l.y)}if(O(l.ha))switch(c.strokeStyle=l.ha,c.lineWidth=l.wa,h.type){case q.I:c.strokeRect(l.x,l.y,l.f,l.b);break;case q.F:c.ellipse(l.x,l.y,l.f,l.b);c.stroke();break;case q.Y:c.moveTo(l.x,l.y);c.lineTo(l.f,l.b);
c.stroke();break;case q.u:c.font=l.b.font,c.strokeText(l.f,l.x,l.y)}}a:{c=M;for(y=c.length-1;0<=y;y--)if(c[y].id==a.id){c=y;break a}c=void 0}c="z-index: "+c;d.setAttribute("style","left: "+a.x+"px; top: "+(K.a+a.y)+"px; "+c);e.setAttribute("style","left: "+a.x+"px; top: "+a.y+"px; "+c);m.strokeStyle=K.oa;m.lineWidth=K.S;m.strokeRect(0,0,a.width,a.height);m.strokeStyle=K.qa;m.lineWidth=K.ra;m.beginPath();m.moveTo(0,K.a);m.lineTo(a.width,K.a);m.stroke()}}}var f=document.getElementById("desktop");f.width=
window.innerWidth;f.height=window.innerHeight;var h=f.getContext("2d");K=a.ia;L={X:{N:K.ea,elements:[]}};var q={I:0,F:1,Y:2,u:3};setInterval(e,20);var x=h;M=[];new P({g:[{action:"compile",source:"/core/os/default/apps/test.js",h:"/apps/test.ose",v:function(b){console.log("Application compiled sucessfully in "+((new Date).getTime()-N).toString()+" milliseconds!");console.log("Result:\n"+b)}},{action:"execute",source:"/apps/test.ose",start:function(){console.log("Finished setup after "+((new Date).getTime()-
N)+" milliseconds!")}}]});new Window(10,10,200,100,"Test");new Window(100,100,200,100,"Test2");M[M.length-1].addEventListener("mousedown",function(b){console.log("X: "+b.x+", Y: "+b.y)});a=new Worker("text.js");a.postMessage({action:"data",value:K});a.postMessage({action:"widthIndex",value:JSON.stringify(Q())});var w=0,E=0,v=null,C=!1,u=8,n=null,z,A,r,t;window.onmousedown=function(b){var a="";v=null;C=!0;for(var e=[],f=0;f<M.length;f++)b.x>M[f].x&&b.x<M[f].x+M[f].width&&b.y>M[f].y&&b.y<M[f].y+M[f].height&&
e.push(f);e.pop();for(f=M.length-1;0<=f;f--){var d=M[f],c=K.V;if(b.x>=d.x&&b.y>=d.y&&b.x<=d.x+d.width&&b.y<=d.y+d.height){if(-1==e.indexOf(f)){b.x>=d.x+c&&b.y>=d.y+c&&b.x<=d.x+d.width-c&&b.y<=d.y+d.height-c&&(a="window",b.y<d.y+K.a&&(v=d,w=b.x-d.x,E=b.y-d.y),M=M.remove(f),M.push(d),e=M[M.length-1],b.y>e.y+K.a&&R(e,"mousedown",{x:b.x-e.x,y:b.y-e.y-K.a}));break}if(f==M.length-1)break}}if(""==a)for(f=M.length-1;0<=f;f--)if(d=M[f],c=K.V,b.x>d.x&&b.x<d.x+c&&b.y>d.y+c&&b.y<d.y+d.height-c?u=p.G:b.x>d.x+
d.width-c&&b.x<d.x+d.width&&b.y>d.y+c&&b.y<d.y+d.height-c?u=p.H:b.x>d.x+c&&b.x<d.x+d.width-c&&b.y>d.y&&b.y<d.y+c?u=p.J:b.x>d.x+c&&b.x<d.x+d.width-c&&b.y>d.y+d.height-c&&b.y<d.y+d.height?u=p.B:b.x>d.x&&b.x<d.x+c&&b.y>d.y&&b.y<d.y+c?u=p.K:b.x>d.x+d.width-c&&b.x<d.x+d.width&&b.y>d.y&&b.y<d.y+c?u=p.L:b.x>d.x&&b.x<d.x+c&&b.y>d.y+d.height-c&&b.y<d.y+d.height?u=p.C:b.x>d.x+d.width-c&&b.x<d.x+d.width&&b.y>d.y+d.height-c&&b.y<d.y+d.height&&(u=p.D),b.x>d.x&&b.x<d.x+d.width&&b.y>d.y&&b.y<d.y+d.height&&!(b.x>
d.x+c&&b.x<d.x+d.width-c&&b.y>d.y+c&&b.y<d.y+d.height-c)){n=d;r=d.x;t=d.y;z=d.width;A=d.height;break}};window.onmousemove=function(b){if(C)if(null!=v)v.s?(v.x=b.x-w,v.y=b.y-E):C=!1;else{if(u!=p.NONE)switch(u){case p.G:b.x<r+z-K.l&&(n.x=b.x,n.width=r-b.x+z);break;case p.H:b.x>r+K.l&&(n.width=b.x-r);break;case p.J:b.y<t+A-K.j&&(n.y=b.y,n.height=t-b.y+A);break;case p.B:b.y>t+K.j&&(n.height=b.y-t);break;case p.K:b.x<r+z-K.l&&(n.x=b.x,n.width=r-b.x+z);b.y<t+A-K.j&&(n.y=b.y,n.height=t-b.y+A);break;case p.L:b.x>
r+K.l&&(n.width=b.x-r);b.y<t+A-K.j&&(n.y=b.y,n.height=t-b.y+A);break;case p.C:b.x<r+z-K.l&&(n.x=b.x,n.width=r-b.x+z);b.y>t+K.j&&(n.height=b.y-t);break;case p.D:b.x>r+K.l&&(n.width=b.x-r),b.y>t+K.j&&(n.height=b.y-t)}}else{for(var a=!1,e=[],f=0;f<M.length;f++)b.x>M[f].x&&b.x<M[f].x+M[f].width&&b.y>M[f].y&&b.y<M[f].y+M[f].height&&e.push(f);e.pop();for(var d=document.body,f=M.length-1;0<=f;f--)if(-1==e.indexOf(f)){var c=M[f],h=K.V;b.x>c.x&&b.x<c.x+h&&b.y>c.y+h&&b.y<c.y+c.height-h?(d.style.cursor="w-resize",
a=!0):b.x>c.x+c.width-h&&b.x<c.x+c.width&&b.y>c.y+h&&b.y<c.y+c.height-h?(d.style.cursor="e-resize",a=!0):b.x>c.x+h&&b.x<c.x+c.width-h&&b.y>c.y&&b.y<c.y+h?(d.style.cursor="n-resize",a=!0):b.x>c.x+h&&b.x<c.x+c.width-h&&b.y>c.y+c.height-h&&b.y<c.y+c.height?(d.style.cursor="s-resize",a=!0):b.x>c.x&&b.x<c.x+h&&b.y>c.y&&b.y<c.y+h?(d.style.cursor="nw-resize",a=!0):b.x>c.x+c.width-h&&b.x<c.x+c.width&&b.y>c.y&&b.y<c.y+h?(d.style.cursor="ne-resize",a=!0):b.x>c.x&&b.x<c.x+h&&b.y>c.y+c.height-h&&b.y<c.y+c.height?
(d.style.cursor="sw-resize",a=!0):b.x>c.x+c.width-h&&b.x<c.x+c.width&&b.y>c.y+c.height-h&&b.y<c.y+c.height&&(d.style.cursor="se-resize",a=!0)}a||(d.style.cursor="default")}a=M[M.length-1];b.x>a.x&&b.x<a.x+a.width&&b.y>a.y+K.a&&b.y<a.y+a.height&&R(a,"mousemove",{x:b.x-a.x,y:b.y-a.y-K.a})};window.onmouseup=function(a){null!=v&&C&&(v.x=a.x-w,v.y=a.y-E,v=null,E=w=0);u!=p.NONE&&(u=p.NONE);var b=M[M.length-1];a.x>b.x&&a.x<b.x+b.width&&a.y>b.y+K.a&&a.y<b.y+b.height&&R(b,"mouseup",{x:a.x-b.x,y:a.y-b.y-K.a});
C=!1};window.onresize=function(){f.width=window.innerWidth;f.height=window.innerHeight;e()};var p={G:0,H:1,J:2,B:3,K:4,L:5,C:6,D:7,NONE:8}}function P(a){S(a)}
function S(a){a="undefined"==typeof a?T:a;for(var e in a.g){var f=a.g[e];if("compile"==f.action){var h=new U(f.source,f.h,function(f){V(h,f);var e=h.compile();$.M({type:"POST",url:"/user/set.php",data:{path:e.h,content:e.code},W:function(){e.v(e.code);a.g=a.g.remove(0);S(a)}})},f.v);break}else"execute"==f.action&&((new W(f.source)).start(),f.start())}}var T={g:[{action:"execute"}]};function U(a,e,f,h){this.$=a;this.R=!1;this.h=e;this.ca=h;$.M({type:"get",url:this.$,W:f})}
U.prototype.compile=function(){if(this.R)return this.aa="importScripts('"+K.va+"');\n"+this.Z,{code:this.aa,v:this.ca,h:this.h};console.warn("Please wait to call compile() until source code has been loaded.")};function V(a,e){a.R=!0;a.Z=e}function W(a){this.path=a;this.m=[]}W.prototype.start=function(){this.A=new Worker("get.php?content_type=text/javascript&path="+this.path);this.A.ja=this;this.A.onmessage=aa};function aa(a){X.c=this.ja;X[a.data.action](a.data.ua)}
var X={"System.println":function(a){console.log(a)},"System.Window.<init>":function(a){var e;M.push(e=new Window(a.x,a.y,a.width,a.height,a.title,void 0,a.P.data));e.ba=this.c;Y(e);e.addEventListener("any",function(a){var e=a.O;a.xa=X["System.Window.getLocalID"](a.window);delete a.window;delete a.O;e.A.postMessage(a)});this.c.m.push({global:e.id,local:a.id})},"System.Window.show":function(a){var e=this["System.Window.getGlobalWindow"](a);this["System.Window.update"](a);e.show()},"System.Window.hide":function(a){var e=
this["System.Window.getGlobalWindow"](a);this["System.Window.update"](a);Y(e)},"System.Window.update":function(a){this["System.Window.getGlobalWindow"](a).update(a)},"System.Window.getGlobalID":function(a){for(var e=0;e<this.c.m.length;e++){var f=this.c.m[e];if(f.local==a.id)return f.global}},"System.Window.getGlobalWindow":function(a){a:{a=this["System.Window.getGlobalID"](a);for(var e=0;e<M.length;e++)if(M[e].id==a){a=M[e];break a}a=void 0}return a},"System.Window.getLocalID":function(a){for(var e=
0;e<this.c.m.length;e++){var f=this.c.m[e];if(f.global==a.id)return f.local}},c:null};Array.prototype.remove=function(a){delete this[a];a=[];for(var e=0;e<this.length;e++)"undefined"!=typeof this[e]&&a.push(this[e]);return a};CanvasRenderingContext2D.prototype.clear=CanvasRenderingContext2D.prototype.clear||function(a){a&&(this.save(),this.setTransform(1,0,0,1,0,0));this.clearRect(0,0,this.canvas.width,this.canvas.height);a&&this.restore()};
function Q(){var a=K.fa,e=[],f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%^&*()`~-=_+[]{}|\"';:/?>.<, ".split(""),h=document.createElement("canvas").getContext("2d");h.font=a;for(a=0;a<f.length;a++){var q=f[a];e.push([q,h.measureText(q).width])}return e}Image.w=function(){var a=K.ma,e=new Image(K.U,K.T);e.src=a;return e};function O(a){return!("undefined"==typeof a||null==a)}
function Window(a,e,f,h,q,x,w){this.update(a,e,f,h,q,x,w);this.id=Z;this.o={};this.s=!0;this.event={mousedown:[],mouseup:[],mousemove:[],keyup:[],keydown:[],any:[]};M.push(this);Z++}Window.prototype.show=function(){this.x=this.o.x;this.y=this.o.y;this.o={};this.s=!0};function Y(a){a.o={x:a.x,y:a.y};a.x=-a.width-K.S;a.y=-a.height-K.S;a.s=!1}
Window.prototype.update=function(a,e,f,h,q,x,w){"object"==typeof a?(this.title=a.title,this.icon="undefined"==typeof a.icon?Image.w():a.icon,this.i="undefined"==typeof a.P.data?L.X:a.P.data):(this.x=a,this.y=e,this.width=f,this.height=h,this.title=q,this.icon="undefined"==typeof x?Image.w():x,this.i="undefined"==typeof w?L.X:w)};Window.prototype.addEventListener=function(a,e){this.event[a].push(e)};
function R(a,e,f){f.la=e;f.window=a;f.O=a.ba;for(var h=0;h<a.event[e].length;h++)a.event[e][h](f);for(h=0;h<a.event.any.length;h++)a.event.any[h](f)}var Z=0;
