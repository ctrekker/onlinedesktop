for(var h="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=e.value)},k="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global?global:this,B=["Array","prototype","fill"],D=0;D<B.length-1;D++){var E=B[D];E in k||(k[E]={});k=k[E]}
var F=B[B.length-1],G=k[F],H=G?G:function(a,b,e){var f=this.length||0;0>b&&(b=Math.max(0,f+b));if(null==e||e>f)e=f;e=Number(e);0>e&&(e=Math.max(0,f+e));for(b=Number(b||0);b<e;b++)this[b]=a;return this};H!=G&&null!=H&&h(k,F,{configurable:!0,writable:!0,value:H});window.onload=function(){var a={};I("/core/os/default/System.json",function(b){a.U=JSON.parse(b);J(a)},"GET")};var K,L,M,N=(new Date).getTime();
function J(a){function b(){m.clear();m.fillStyle=K.osDesktopBackground;m.fillRect(0,0,e.width,e.height);for(var v=0;v<M.length;v++){var a=M[v],b=document.getElementById("wcanvas_"+a.id),f=document.getElementById("gcanvas_"+a.id);if(a.j){null==b&&(b=document.createElement("canvas"),b.setAttribute("class","dynamic-canvas"),b.setAttribute("id","wcanvas_"+a.id),document.body.appendChild(b));b.width=a.width;b.height=a.height;var c=b.getContext("2d");null==f&&(f=document.createElement("canvas"),f.setAttribute("class",
"dynamic-canvas"),f.setAttribute("id","gcanvas_"+a.id),document.body.appendChild(f));f.width=a.width;f.height=a.height-K.osWindowOptionsHeight;var d=f.getContext("2d");c.fillStyle=K.osWindowOptionsBackground;c.fillRect(0,0,a.width,K.osWindowOptionsHeight);c.fillStyle="null"==a.f.J?a.f.J:K.osWindowContentBackground;c.fillRect(0,K.osWindowOptionsHeight,a.width,a.height-K.osWindowOptionsHeight);try{c.drawImage(a.icon,K.osWindowOptionsPadding,K.osWindowOptionsHeight/2-K.osWindowIconHeight/2,K.osWindowIconWidth,
K.osWindowIconHeight)}catch(ea){a.icon=Image.s()}c.font=K.osWindowContentFont;c.textBaseline="middle";c.fillStyle=K.osWindowOptionsColor;c.fillText(a.title,K.osWindowOptionsPadding+K.osWindowIconWidth+K.osWindowOptionsTitleIconSeperation,K.osWindowOptionsHeight/2);c.textBaseline="top";for(var y=0;y<a.f.elements.length;y++){var n=a.f.elements[y],l=n.data;n.type==g.l&&(d.textBaseline=l.h.baseline,d.textAlign=l.h.align);if(O(l.fc))switch(d.fillStyle=l.fc.data,n.type){case g.F:P(d,l.x,l.y,l.w,l.h,Q(l.e.round));
d.fill();break;case g.B:R(d,l.x+l.w/2,l.y+l.h/2,l.w,l.h);d.fill();break;case g.l:d.font=l.h.font,d.fillText(l.w,l.x,l.y)}if(O(l.sc))switch(d.strokeStyle=l.sc.data,d.lineWidth=l.ss,n.type){case g.F:P(d,l.x,l.y,l.w,l.h,Q(l.e.round));d.stroke();break;case g.B:R(d,l.x+l.w/2,l.y+l.h/2,l.w,l.h);d.stroke();break;case g.N:d.beginPath();d.moveTo(l.x,l.y);d.lineTo(l.w,l.h);d.closePath();d.stroke();break;case g.l:d.font=l.h.font,d.strokeText(l.w,l.x,l.y)}}a:{d=M;for(y=d.length-1;0<=y;y--)if(d[y].id==a.id){d=
y;break a}d=void 0}d="z-index: "+d;f.setAttribute("style","left: "+a.x+"px; top: "+(K.osWindowOptionsHeight+a.y)+"px; "+d);b.setAttribute("style","left: "+a.x+"px; top: "+a.y+"px; "+d);c.strokeStyle=K.osWindowBorder;c.lineWidth=K.osWindowBorderWidth;c.strokeRect(0,0,a.width,a.height);c.strokeStyle=K.osWindowOptionsBorder;c.lineWidth=K.osWindowOptionsBorderWidth;c.beginPath();c.moveTo(0,K.osWindowOptionsHeight);c.lineTo(a.width,K.osWindowOptionsHeight);c.stroke()}else null!=b&&null!=f&&(b.setAttribute("style",
"hidden"),f.setAttribute("style","hidden"))}}var e=document.getElementById("desktop");e.width=window.innerWidth;e.height=window.innerHeight;var f=e.getContext("2d");K=a.U;L={M:{J:K.osWindowContentBackground,elements:[]}};var g={F:0,B:1,N:2,l:3};setInterval(b,20);var m=f;M=[];new S({b:[{action:"compile",source:"/core/os/default/apps/counter.js",c:"/apps/counter.ose",m:function(a){console.log("Counter compiled sucessfully in "+((new Date).getTime()-N).toString()+" milliseconds!");console.log("Result:\n"+
a)}},{action:"execute",source:"/apps/counter.ose",start:function(){console.log("Finished setup after "+((new Date).getTime()-N)+" milliseconds!")}}]});new Window(10,10,200,100,"Test");new Window(100,100,200,100,"Test2");M[M.length-1].addEventListener("mousedown",function(a){console.log("X: "+a.x+", Y: "+a.y)});a=new Worker("text.js");a.postMessage({action:"data",value:K});a.postMessage({action:"widthIndex",value:JSON.stringify(T())});var r=0,x=0,q=null,C=!1,w=8,n=null,z,A,t,u;window.onmousedown=function(a){var b=
"";q=null;C=!0;for(var v=[],e=0;e<M.length;e++)a.x>M[e].x&&a.x<M[e].x+M[e].width&&a.y>M[e].y&&a.y<M[e].y+M[e].height&&v.push(e);v.pop();for(e=M.length-1;0<=e;e--){var c=M[e],d=K.osWindowResizeMargin;if(a.x>=c.x&&a.y>=c.y&&a.x<=c.x+c.width&&a.y<=c.y+c.height){if(-1==v.indexOf(e)){a.x>=c.x+d&&a.y>=c.y+d&&a.x<=c.x+c.width-d&&a.y<=c.y+c.height-d&&(b="window",a.y<c.y+K.osWindowOptionsHeight&&(q=c,r=a.x-c.x,x=a.y-c.y),M=M.remove(e),M.push(c),v=M[M.length-1],a.y>v.y+K.osWindowOptionsHeight&&U(v,"mousedown",
{x:a.x-v.x,y:a.y-v.y-K.osWindowOptionsHeight}));break}if(e==M.length-1)break}}if(""==b)for(e=M.length-1;0<=e;e--)if(c=M[e],d=K.osWindowResizeMargin,a.x>c.x&&a.x<c.x+d&&a.y>c.y+d&&a.y<c.y+c.height-d?w=p.C:a.x>c.x+c.width-d&&a.x<c.x+c.width&&a.y>c.y+d&&a.y<c.y+c.height-d?w=p.D:a.x>c.x+d&&a.x<c.x+c.width-d&&a.y>c.y&&a.y<c.y+d?w=p.G:a.x>c.x+d&&a.x<c.x+c.width-d&&a.y>c.y+c.height-d&&a.y<c.y+c.height?w=p.u:a.x>c.x&&a.x<c.x+d&&a.y>c.y&&a.y<c.y+d?w=p.H:a.x>c.x+c.width-d&&a.x<c.x+c.width&&a.y>c.y&&a.y<c.y+
d?w=p.I:a.x>c.x&&a.x<c.x+d&&a.y>c.y+c.height-d&&a.y<c.y+c.height?w=p.v:a.x>c.x+c.width-d&&a.x<c.x+c.width&&a.y>c.y+c.height-d&&a.y<c.y+c.height&&(w=p.A),a.x>c.x&&a.x<c.x+c.width&&a.y>c.y&&a.y<c.y+c.height&&!(a.x>c.x+d&&a.x<c.x+c.width-d&&a.y>c.y+d&&a.y<c.y+c.height-d)){n=c;t=c.x;u=c.y;z=c.width;A=c.height;break}};window.onmousemove=function(a){if(C)if(null!=q)q.j?(q.x=a.x-r,q.y=a.y-x):C=!1;else{if(w!=p.NONE)switch(w){case p.C:a.x<t+z-K.osWindowMinimumWidth&&(n.x=a.x,n.width=t-a.x+z);break;case p.D:a.x>
t+K.osWindowMinimumWidth&&(n.width=a.x-t);break;case p.G:a.y<u+A-K.osWindowMinimumHeight&&(n.y=a.y,n.height=u-a.y+A);break;case p.u:a.y>u+K.osWindowMinimumHeight&&(n.height=a.y-u);break;case p.H:a.x<t+z-K.osWindowMinimumWidth&&(n.x=a.x,n.width=t-a.x+z);a.y<u+A-K.osWindowMinimumHeight&&(n.y=a.y,n.height=u-a.y+A);break;case p.I:a.x>t+K.osWindowMinimumWidth&&(n.width=a.x-t);a.y<u+A-K.osWindowMinimumHeight&&(n.y=a.y,n.height=u-a.y+A);break;case p.v:a.x<t+z-K.osWindowMinimumWidth&&(n.x=a.x,n.width=t-a.x+
z);a.y>u+K.osWindowMinimumHeight&&(n.height=a.y-u);break;case p.A:a.x>t+K.osWindowMinimumWidth&&(n.width=a.x-t),a.y>u+K.osWindowMinimumHeight&&(n.height=a.y-u)}}else{for(var b=!1,e=[],f=0;f<M.length;f++)a.x>M[f].x&&a.x<M[f].x+M[f].width&&a.y>M[f].y&&a.y<M[f].y+M[f].height&&e.push(f);e.pop();for(var c=document.body,f=M.length-1;0<=f;f--)if(-1==e.indexOf(f)){var d=M[f],g=K.osWindowResizeMargin;a.x>d.x&&a.x<d.x+g&&a.y>d.y+g&&a.y<d.y+d.height-g?(c.style.cursor="w-resize",b=!0):a.x>d.x+d.width-g&&a.x<
d.x+d.width&&a.y>d.y+g&&a.y<d.y+d.height-g?(c.style.cursor="e-resize",b=!0):a.x>d.x+g&&a.x<d.x+d.width-g&&a.y>d.y&&a.y<d.y+g?(c.style.cursor="n-resize",b=!0):a.x>d.x+g&&a.x<d.x+d.width-g&&a.y>d.y+d.height-g&&a.y<d.y+d.height?(c.style.cursor="s-resize",b=!0):a.x>d.x&&a.x<d.x+g&&a.y>d.y&&a.y<d.y+g?(c.style.cursor="nw-resize",b=!0):a.x>d.x+d.width-g&&a.x<d.x+d.width&&a.y>d.y&&a.y<d.y+g?(c.style.cursor="ne-resize",b=!0):a.x>d.x&&a.x<d.x+g&&a.y>d.y+d.height-g&&a.y<d.y+d.height?(c.style.cursor="sw-resize",
b=!0):a.x>d.x+d.width-g&&a.x<d.x+d.width&&a.y>d.y+d.height-g&&a.y<d.y+d.height&&(c.style.cursor="se-resize",b=!0)}b||(c.style.cursor="default")}b=M[M.length-1];a.x>b.x&&a.x<b.x+b.width&&a.y>b.y+K.osWindowOptionsHeight&&a.y<b.y+b.height&&U(b,"mousemove",{x:a.x-b.x,y:a.y-b.y-K.osWindowOptionsHeight})};window.onmouseup=function(a){null!=q&&C&&(q.x=a.x-r,q.y=a.y-x,q=null,x=r=0);w!=p.NONE&&(w=p.NONE);var b=M[M.length-1];a.x>b.x&&a.x<b.x+b.width&&a.y>b.y+K.osWindowOptionsHeight&&a.y<b.y+b.height&&U(b,"mouseup",
{x:a.x-b.x,y:a.y-b.y-K.osWindowOptionsHeight});C=!1};window.onresize=function(){e.width=window.innerWidth;e.height=window.innerHeight;b()};var p={C:0,D:1,G:2,u:3,H:4,I:5,v:6,A:7,NONE:8}}function S(a){V(a)}
function V(a){a="undefined"==typeof a?aa:a;for(var b in a.b){var e=a.b[b];if("compile"==e.action){var f=new W(e.source,e.c,function(b){ba(f,b);var e=f.compile();ca({path:e.c,content:e.code},function(){e.m(e.code);a.b=a.b.remove(0);V(a)})},e.m);break}else"execute"==e.action&&((new X(e.source)).start(),e.start())}}var aa={b:[{action:"execute"}]};
function W(a,b,e,f){this.P=a;this.K=!1;this.c=b;this.T=f;a=this.P;b={};f=[];for(var g in b)f.push(encodeURIComponent(g)+"="+encodeURIComponent(b[g]));I(a+(f.length?"?"+f.join("&"):""),e,"GET",null,void 0)}W.prototype.compile=function(){if(this.K)return this.R="importScripts('"+K.scriptLangPath+"');\n"+this.O,{code:this.R,m:this.T,c:this.c};console.warn("Please wait to call compile() until source code has been loaded.")};function ba(a,b){a.K=!0;a.O=b}function X(a){this.path=a;this.g=[]}
X.prototype.start=function(){this.internalWorker=new Worker("get.php?content_type=text/javascript&path="+this.path);this.internalWorker.V=this;var a=this;this.internalWorker.onmessage=function(b){b.o=a;b.o.L.a=b.o;b.o.L[b.data.action](b.data.params)}};
X.prototype.L={"System.println":function(a){console.log(a)},"System.Window.<init>":function(a){var b;M.push(b=new Window(a.x,a.y,a.width,a.height,a.title,void 0,a.graphics.data));b.S=this;Y(b);b.addEventListener("any",function(a){var b=a.executor;a.windowID=b["System.Window.getLocalID"](a.window);delete a.window;delete a.executor;b.a.internalWorker.postMessage(a)});this.a.g.push({global:b.id,local:a.id})},"System.Window.show":function(a){var b=this["System.Window.getGlobalWindow"](a);this["System.Window.update"](a);
b.show()},"System.Window.hide":function(a){var b=this["System.Window.getGlobalWindow"](a);this["System.Window.update"](a);Y(b)},"System.Window.update":function(a){this["System.Window.getGlobalWindow"](a).update(a)},"System.Window.getGlobalID":function(a){for(var b=0;b<this.a.g.length;b++){var e=this.a.g[b];if(e.local==a.id)return e.global}},"System.Window.getGlobalWindow":function(a){a:{a=this["System.Window.getGlobalID"](a);for(var b=0;b<M.length;b++)if(M[b].id==a){a=M[b];break a}a=void 0}return a},
"System.Window.getLocalID":function(a){for(var b=0;b<this.a.g.length;b++){var e=this.a.g[b];if(e.global==a.id)return e.local}},a:this};function Q(a){return"undefined"==typeof a?0:a}Array.prototype.remove=function(a){delete this[a];a=[];for(var b=0;b<this.length;b++)"undefined"!=typeof this[b]&&a.push(this[b]);return a};
CanvasRenderingContext2D.prototype.clear=CanvasRenderingContext2D.prototype.clear||function(a){a&&(this.save(),this.setTransform(1,0,0,1,0,0));this.clearRect(0,0,this.canvas.width,this.canvas.height);a&&this.restore()};function P(a,b,e,f,g,m){m=Q(m);f<2*m&&(m=f/2);g<2*m&&(m=g/2);a.beginPath();a.moveTo(b+m,e);a.arcTo(b+f,e,b+f,e+g,m);a.arcTo(b+f,e+g,b,e+g,m);a.arcTo(b,e+g,b,e,m);a.arcTo(b,e,b+f,e,m);a.closePath()}
function R(a,b,e,f,g){a.beginPath();var m=b-f/2,r=b+f/2,x=e-g/2,q=e+g/2;f=.551784*f/2;g=.551784*g/2;a.moveTo(b,x);a.bezierCurveTo(b+f,x,r,e-g,r,e);a.bezierCurveTo(r,e+g,b+f,q,b,q);a.bezierCurveTo(b-f,q,m,e+g,m,e);a.bezierCurveTo(m,e-g,b-f,x,b,x);a.closePath()}
function T(){var a=K.osWindowContentFont,b=[],e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%^&*()`~-=_+[]{}|\"';:/?>.<, ".split(""),f=document.createElement("canvas").getContext("2d");f.font=a;for(a=0;a<e.length;a++){var g=e[a];b.push([g,f.measureText(g).width])}return b}Image.s=function(){var a=K.osApplicationIcon,b=new Image(K.osWindowIconWidth,K.osWindowIconHeight);b.src=a;return b};function O(a){return!("undefined"==typeof a||null==a)}
function Window(a,b,e,f,g,m,r){this.update(a,b,e,f,g,m,r);this.id=Z;this.i={};this.j=!0;this.event={mousedown:[],mouseup:[],mousemove:[],keyup:[],keydown:[],any:[]};M.push(this);Z++}Window.prototype.show=function(){this.x=this.i.x;this.y=this.i.y;this.i={};this.j=!0};function Y(a){a.i={x:a.x,y:a.y};a.x=-a.width-K.osWindowBorderWidth;a.y=-a.height-K.osWindowBorderWidth;a.j=!1}
Window.prototype.update=function(a,b,e,f,g,m,r){"object"==typeof a?(this.title=a.title,this.icon="undefined"==typeof a.icon?Image.s():a.icon,this.f="undefined"==typeof a.graphics.data?L.M:a.graphics.data):(this.x=a,this.y=b,this.width=e,this.height=f,this.title=g,this.icon="undefined"==typeof m?Image.s():m,this.f="undefined"==typeof r?L.M:r)};Window.prototype.addEventListener=function(a,b){this.event[a].push(b)};
function U(a,b,e){e.eventType=b;e.window=a;e.executor=a.S;for(var f=0;f<a.event[b].length;f++)a.event[b][f](e);for(f=0;f<a.event.any.length;f++)a.event.any[f](e)}var Z=0;function da(){if("undefined"!==typeof XMLHttpRequest)return new XMLHttpRequest;for(var a="MSXML2.XmlHttp.6.0 MSXML2.XmlHttp.5.0 MSXML2.XmlHttp.4.0 MSXML2.XmlHttp.3.0 MSXML2.XmlHttp.2.0 Microsoft.XmlHttp".split(" "),b,e=0;e<a.length;e++)try{b=new ActiveXObject(a[e]);break}catch(f){}return b}
function I(a,b,e,f,g){void 0===g&&(g=!0);var m=da();m.open(e,a,g);m.onreadystatechange=function(){4==m.readyState&&b(m.responseText)};"POST"==e&&m.setRequestHeader("Content-type","application/x-www-form-urlencoded");m.send(f)}function ca(a,b){var e=[],f;for(f in a)e.push(encodeURIComponent(f)+"="+encodeURIComponent(a[f]));I("/user/set.php",b,"POST",e.join("&"),void 0)};
